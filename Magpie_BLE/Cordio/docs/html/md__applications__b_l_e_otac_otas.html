<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cordio: BLE_otac</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cordio
   </div>
   <div id="projectbrief">Cordio Bluetooth Low Energy Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__applications__b_l_e_otac_otas.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">BLE_otac </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Description</h2>
<p>Bluetooth data client that scans for and connects to advertisers with the name of "OTAS".</p>
<p>The Wireless Data Exchange profile is used to transfer files from the client to the server. A CRC32 value is used to check the integrity of the transferred file.</p>
<h2>Usage</h2>
<h3>LEDs</h3>
<p>The red LED will indicate that an error assertion has occurred.</p>
<p>The green LED indicates CPU activity. When the LED is on, the CPU is active, when the LED is off, the CPU is in sleep mode.</p>
<h3>Setup</h3>
<p>The <code>project.mk</code> can be edited to select the appropriate application directory for the update image. Change FW_UPDATE_DIR to modify which application is used for the update. Whichever application is selected must be setup to run from the appropriate memory section, as defined by the Bootloader.</p>
<h3>Expected Output</h3>
<p>On startup: </p><div class="fragment"><div class="line">terminal: init</div><div class="line">32kHz trimmed to 0x16</div><div class="line">DatcHandlerInit</div><div class="line">File addr: 10025950 file size: 00033368</div><div class="line">Update File CRC: 0x8871C78B</div><div class="line">WDXC: WdxcHandlerInit</div><div class="line">&gt;&gt;&gt; Reset complete &lt;&lt;&lt;</div><div class="line">Database hash updated</div><div class="line">dmDevPassEvtToDevPriv: event: 12, param: 36, advHandle: 0</div><div class="line">&gt;&gt;&gt; Scanning started &lt;&lt;&lt;</div></div><!-- fragment --><p>When a connection has been made. </p><div class="fragment"><div class="line">dmDevPassEvtToDevPriv: event: 13, param: 37, advHandle: 0</div><div class="line">Scan results: 10</div><div class="line">dmConnIdByBdAddr not found</div><div class="line">dmConnCcbAlloc 1</div><div class="line">&gt;&gt;&gt; Scanning stopped &lt;&lt;&lt;</div><div class="line">dmConnSmExecute event=24 state=0</div><div class="line">dmDevPassEvtToDevPriv: event: 14, param: 0, advHandle: 0</div><div class="line">dmConnSmExecute event=28 state=1</div><div class="line">dmDevPassEvtToDevPriv: event: 14, param: 1, advHandle: 0</div><div class="line">dmDevPassEvtToDevPriv: event: 12, param: 39, advHandle: 0</div><div class="line">smpDbGetRecord: connId: 1 type: 0</div><div class="line">smpDbAddDevice</div><div class="line">SmpDbGetFailureCount: connId: 1 count: 0</div><div class="line">smpDbGetRecord: connId: 1 type: 0</div><div class="line">smpDbAddDevice</div><div class="line">SmpDbGetPairingDisabledTime: connId: 1 period: 0 attemptMult: 0</div><div class="line">&gt;&gt;&gt; Connection opened &lt;&lt;&lt;</div><div class="line">connId=1 idleMask=0x0008</div><div class="line">AttcDiscServiceCmpl status 0x00</div><div class="line">AttcDiscCharCmpl status 0x79</div><div class="line">AttcDiscCharCmpl status 0x79</div><div class="line">AttcDiscCharCmpl status 0x00</div><div class="line">connId=1 idleMask=0x0008</div><div class="line">AttcDiscServiceCmpl status 0x00</div><div class="line">AttcDiscCharCmpl status 0x79</div><div class="line">AttcDiscCharCmpl status 0x00</div><div class="line">connId=1 idleMask=0x0008</div><div class="line">AttcDiscServiceCmpl status 0x00</div><div class="line">AttcDiscCharCmpl status 0x79</div><div class="line">AttcDiscCharCmpl status 0x79</div><div class="line">AttcDiscCharCmpl status 0x00</div><div class="line">connId=1 idleMask=0x0008</div><div class="line">AttcDiscServiceCmpl status 0x00</div><div class="line">AttcDiscCharCmpl status 0x79</div><div class="line">AttcDiscCharCmpl status 0x79</div><div class="line">AttcDiscCharCmpl status 0x79</div><div class="line">AttcDiscCharCmpl status 0x79</div><div class="line">AttcDiscCharCmpl status 0x79</div><div class="line">AttcDiscCharCmpl status 0x79</div><div class="line">AttcDiscCharCmpl status 0x00</div><div class="line">connId=1 idleMask=0x0000</div><div class="line">AppDiscComplete connId:1 status:0x04</div><div class="line">connId=1 idleMask=0x0008</div><div class="line">AttcDiscConfigCmpl status 0x79</div><div class="line">AttcDiscConfigCmpl status 0x79</div><div class="line">AttcDiscConfigCmpl status 0x79</div><div class="line">AttcDiscConfigCmpl status 0x79</div><div class="line">AttcDiscConfigCmpl status 0x79</div><div class="line">AttcDiscConfigCmpl status 0x79</div><div class="line">AttcDiscConfigCmpl status 0x00</div><div class="line">connId=1 idleMask=0x0000</div><div class="line">AppDiscComplete connId:1 status:0x08</div></div><!-- fragment --><p>OTA procedure </p><div class="fragment"><div class="line">btn 2 s</div><div class="line">Short Button 2 Press</div><div class="line">&gt; </div><div class="line">WDXC file transfer control.</div><div class="line">FTC op: 2 status: 0</div><div class="line"></div><div class="line">WDXC file transfer control.</div><div class="line">FTC op: 10 status: 0</div><div class="line">&gt;&gt;&gt; File discovery complete &lt;&lt;&lt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; Current fw version: 1.0 &lt;&lt;&lt;                                              </div><div class="line"></div><div class="line">btn 2 m                                                                       </div><div class="line">Medium Button 2 Press                                                         </div><div class="line">&gt; WDXC file transfer control.                                                 </div><div class="line">FTC op: 4 status: 0                                                           </div><div class="line">&gt;&gt;&gt; Starting file transfer &lt;&lt;&lt;</div><div class="line">... </div><div class="line">WDXC file transfer control.</div><div class="line">FTC op: 10 status: 0</div><div class="line">&gt;&gt;&gt; File transfer complete 3547207 us &lt;&lt;&lt;</div><div class="line">file_size = 209768 usec = 3547207 bps = 473112</div><div class="line">flowDisabled=0 handle=0</div><div class="line"></div><div class="line"></div><div class="line">btn 2 l                                                                       </div><div class="line">Long Button 2 Press                                                           </div><div class="line">&gt; WDXC file transfer control.                                                 </div><div class="line">FTC op: 8 status: 0                                                           </div><div class="line">&gt;&gt;&gt; Verify complete status: 0 &lt;&lt;&lt; </div><div class="line"></div><div class="line"></div><div class="line">btn 2 x                                                                       </div><div class="line">XL Button 2 Press                                                             </div><div class="line">&gt; dmConnSmExecute event=29 state=3                                            </div><div class="line">dmConnCcbDealloc 1                                                            </div><div class="line">dmDevPassEvtToDevPriv: event: 13, param: 40, advHandle: 0                     </div><div class="line">smpDbGetRecord: connId: 1 type: 0                                             </div><div class="line">smpDbAddDevice                                                                </div><div class="line">SmpDbSetFailureCount: connId: 1 count: 0                                      </div><div class="line">smpSmExecute event=10 state=0                                                 </div><div class="line">Connection closed status 0x0, reason 0x13                                     </div><div class="line"> REMOTE TERM                                                                  </div><div class="line">&gt;&gt;&gt; Connection closed &lt;&lt;&lt;</div></div><!-- fragment --><h3>Commands</h3>
<p>Type the desired command and parameter (if applicable) and press enter to execute the command.</p>
<p><b>help</b> Displays the available commands. <b>echo</b> (on|off) Enables or disables the input echo. On by default. <b>btn</b> (ID) (s|m|l|x) Simulates button presses. Example: "btn 1 s" for a short button press on button 1. <b>pin</b> (ConnID) (Pin Code) Used to input the pairing pin code.</p>
<h2>Push buttons</h2>
<p>Push buttons can be used to interact with the application.</p>
<p><b>short</b> press is less than 200 ms <b>medium</b> press is between 200 and 500 ms <b>long</b> press is between 500 and 1000 ms <b>extra long</b> press is greater than 1000 ms</p>
<h3>When connected</h3>
<ol type="1">
<li>Button 1 short: On/Off scanning</li>
<li>Button 1 medium: Cycle through the connection index</li>
<li>Button 1 long: Drop selected connection</li>
<li>Button 1 extra long: Toggle PHY</li>
<li>Button 2 short: Discover file space on the peer device.</li>
<li>Button 2 medium: Start the update transfer.</li>
<li>Button 2 long: Verify the transfer.</li>
<li>Button 2 extra long: Command the peer to disconnect and reset.</li>
</ol>
<h3>When disconnected</h3>
<ol type="1">
<li>Button 1 short press: On/Off scanning</li>
<li>Button 1 medium press: Cycle through the connection index</li>
<li>Button 1 long press: Clear all bonding info</li>
<li>Button 1 extra long press: Add RPAO characteristic to GAP service &ndash; needed only when DM Privacy enabled</li>
<li>Button 2 extra long press: Enable device privacy &ndash; start generating local RPAs every 15 minutes</li>
</ol>
<h1>BLE_otas</h1>
<h2>Description</h2>
<p>Bluetooth data server that advertises as "OTAS" and accepts connection requests.</p>
<p>The Wireless Data Exchange profile is used to transfer files from the client to the server's internal/external flash. A CRC32 value is used to check the integrity of the transferred file. </p><h2>Usage</h2>
<h3>LEDs</h3>
<p>The red LED will indicate that an error assertion has occurred.</p>
<p>The green LED indicates CPU activity. When the LED is on, the CPU is active, when the LED is off, the CPU is in sleep mode.</p>
<h3>Setup</h3>
<p>The <code>Bootloader</code> application needs to be loaded prior to loading <code>BLE_otas</code> application. <code>BLE_otas</code> will run on top of the <code>Bootloader</code>. The linker file included with <code>BLE_otas</code> application must be used to properly setup the memory sections to coincide with the <code>Bootloader</code>. The <code>project.mk</code> in this <code>BLE_otas</code> application in conjunction with <code>project.mk</code> in <code>Bootloader</code> determine where the expected file is stored and read from. Default configuration is to use external flash to store the transferd file before writing it to internal flash space during the update. Alternatively by changing <code>USE_INTERNAL_FLASH ?=0</code> to <code>USE_INTERNAL_FLASH ?=1</code> the transfered file is stored in the update space.</p>
<h3>Expected Output</h3>
<p>On startup: </p><div class="fragment"><div class="line">terminal: init</div><div class="line">32kHz trimmed to 0x18</div><div class="line">DatsHandlerInit</div><div class="line">WDXS: WdxsHandlerInit</div><div class="line">FW_VERSION: 1.0</div><div class="line">File Hdl: 1</div><div class="line">Dats got evt 32</div><div class="line">&gt;&gt;&gt; Reset complete &lt;&lt;&lt;</div><div class="line">dmAdvActConfig: state: 0</div><div class="line">dmAdvActSetData: state: 0</div><div class="line">dmAdvActSetData: state: 0</div><div class="line">dmAdvActStart: state: 0</div><div class="line">HCI_LE_ADV_ENABLE_CMD_CMPL_CBACK_EVT: state: 3</div><div class="line">dmDevPassEvtToDevPriv: event: 12, param: 33, advHandle: 0</div><div class="line">Dats got evt 33</div><div class="line">&gt;&gt;&gt; Advertising started &lt;&lt;&lt;</div></div><!-- fragment --><p>When a connection has been made. </p><div class="fragment"><div class="line">dmConnIdByBdAddr not found</div><div class="line">dmConnCcbAlloc 1</div><div class="line">dmConnSmExecute event=28 state=0</div><div class="line">dmAdvConnected: state: 1</div><div class="line">dmDevPassEvtToDevPriv: event: 13, param: 34, advHandle: 0</div><div class="line">smpDbGetRecord: connId: 1 type: 0</div><div class="line">smpDbAddDevice</div><div class="line">SmpDbGetFailureCount: connId: 1 count: 0</div><div class="line">smpDbGetRecord: connId: 1 type: 0</div><div class="line">smpDbAddDevice</div><div class="line">SmpDbGetPairingDisabledTime: connId: 1 period: 0 attemptMult: 0</div><div class="line">Dats got evt 39</div><div class="line">&gt;&gt;&gt; Connection opened &lt;&lt;&lt;</div><div class="line">Dats got evt 65</div><div class="line">Dats got evt 87</div><div class="line">connId=1 idleMask=0x0004</div><div class="line">connId=1 idleMask=0x0004</div><div class="line">connId=1 idleMask=0x0004</div><div class="line">connId=1 idleMask=0x0004</div><div class="line">connId=1 idleMask=0x0004</div><div class="line">connId=1 idleMask=0x0004</div><div class="line">connId=1 idleMask=0x0004</div><div class="line">connId=1 idleMask=0x0004</div><div class="line">connId=1 idleMask=0x0004</div><div class="line">connId=1 idleMask=0x0004</div><div class="line">connId=1 idleMask=0x0004</div></div><!-- fragment --><p>Upon reception of <code>btn 2 s</code> command </p><div class="fragment"><div class="line">WDXS: FTC Write: len=12</div><div class="line">WDXS: FTC Write: op=1 handle=0</div><div class="line">WDXS: FTC GetReq handle=0 len=9</div><div class="line">WDXS: FTC SendRsp op=2 handle=0 status=0</div><div class="line">WDXS: Task Handler Evt=1</div><div class="line">WDXS: FTC Send</div><div class="line">WDXS: AttHook handle=581 event=18</div><div class="line">WDXS: Task Handler Evt=1</div><div class="line">WDXS: FTC SendRsp op=10 handle=0 status=0</div><div class="line">WDXS: AttHook handle=584 event=18</div><div class="line">WDXS: Task Handler Evt=1</div><div class="line">WDXS: FTC Send</div><div class="line">WDXS: AttHook handle=581 event=18</div><div class="line">WDXS: Task Handler Evt=1</div></div><!-- fragment --><p>Upon reception of <code>btn 2 m</code> command </p><div class="fragment"><div class="line">WDXS: FTC Write: len=16</div><div class="line">WDXS: FTC Write: op=3 handle=1</div><div class="line">WDXS: FTC PutReq handle=1 offset=0, len=209768</div><div class="line">&gt;&gt;&gt; Initiating erase of 52 4K sectors in external flash &lt;&lt;&lt;</div><div class="line">WDXS: FTC PutReq handle=1 status=0</div><div class="line">&gt;&gt;&gt; Erasing address 0x1000 in external flash &lt;&lt;&lt;</div><div class="line">&gt;&gt;&gt; Erasing address 0x2000 in external flash &lt;&lt;&lt;</div><div class="line">&gt;&gt;&gt; Erasing address 0x3000 in external flash &lt;&lt;&lt;</div><div class="line">&gt;&gt;&gt; Erasing address 0x4000 in external flash &lt;&lt;&lt;</div><div class="line">&gt;&gt;&gt; Erasing address 0x5000 in external flash &lt;&lt;&lt;</div><div class="line">&gt;&gt;&gt; Erasing address 0x6000 in external flash &lt;&lt;&lt;</div><div class="line">&gt;&gt;&gt; Erasing address 0x7000 in external flash &lt;&lt;&lt;</div><div class="line">&gt;&gt;&gt; Erasing address 0x8000 in external flash &lt;&lt;&lt;</div><div class="line">...</div><div class="line">...</div><div class="line">&gt;&gt;&gt; External flash erase complete &lt;&lt;&lt;</div><div class="line">WDXS: FTC SendRsp op=4 handle=1 status=0</div><div class="line">WDXS: Task Handler Evt=1</div><div class="line">WDXS: FTC Send</div><div class="line">WDXS: AttHook handle=581 event=18</div><div class="line">WDXS: Task Handler Evt=1</div><div class="line">Ext Flash: Wrote 224 bytes @ 0x00000008</div><div class="line">Ext Flash: Wrote 224 bytes @ 0x000000E8</div><div class="line">Ext Flash: Wrote 224 bytes @ 0x000001C8</div><div class="line">Ext Flash: Wrote 224 bytes @ 0x000002A8</div><div class="line">Ext Flash: Wrote 224 bytes @ 0x00000388</div><div class="line">Ext Flash: Wrote 224 bytes @ 0x00000468</div><div class="line">Ext Flash: Wrote 224 bytes @ 0x00000548</div><div class="line">Ext Flash: Wrote 224 bytes @ 0x00000628</div><div class="line">...</div><div class="line">...</div><div class="line">WDXS: FTC SendRsp op=10 handle=1 status=0</div><div class="line">WDXS: Task Handler Evt=1</div><div class="line">WDXS: FTC Send</div><div class="line">WDXS: AttHook handle=581 event=18</div><div class="line">WDXS: Task Handler Evt=1</div></div><!-- fragment --><p>Upon reception of <code>btn 2 l</code> command </p><div class="fragment"><div class="line">WDXS: FTC Write: len=3</div><div class="line">WDXS: FTC Write: op=7 handle=1</div><div class="line">WDXS: FTC VerifyReq: handle=1</div><div class="line">CRC start addr: 0x00000000 Len: 0x00033368</div><div class="line">CRC From File : 0x8871C78B</div><div class="line">CRC Calculated: 0x8871C78B</div><div class="line">WDXS: FTC SendRsp op=8 handle=1 status=0</div><div class="line">WDXS: Task Handler Evt=1</div><div class="line">WDXS: FTC Send</div><div class="line">WDXS: AttHook handle=581 event=18</div><div class="line">WDXS: Task Handler Evt=1</div></div><!-- fragment --><p>Upon reception of <code>btn 2 x</code> command </p><div class="fragment"><div class="line">connId=1 idleMask=0x0000</div><div class="line">dmConnSmExecute event=25 state=3</div><div class="line">dmConnSmExecute event=29 state=4</div><div class="line">dmConnCcbDealloc 1</div><div class="line">smpDbGetRecord: connId: 1 type: 0</div><div class="line">smpDbAddDevice</div><div class="line">SmpDbSetFailureCount: connId: 1 count: 0</div><div class="line">smpSmExecute event=10 state=0</div><div class="line">Dats got evt 40</div><div class="line">Reseting!</div></div><!-- fragment --><p>On successful update the device resets and connects once again.</p>
<h3>Commands</h3>
<p>Type the desired command and parameter (if applicable) and press enter to execute the command.</p>
<p><b>help</b> Displays the available commands. <b>echo</b> (on|off) Enables or disables the input echo. On by default. <b>btn</b> (ID) (s|m|l|x) Simulates button presses. Example: "btn 1 s" for a short button press on button 1. <b>pin</b> (ConnID) (Pin Code) Used to input the pairing pin code.</p>
<h2>Push buttons</h2>
<p>Push buttons can be used to interact with the application.</p>
<p><b>short</b> press is less than 200 ms <b>medium</b> press is between 200 and 500 ms <b>long</b> press is between 500 and 1000 ms <b>extra long</b> press is greater than 1000 ms</p>
<h3>When connected</h3>
<ol type="1">
<li>Button 2 short press: Toggle PHY</li>
<li>Button 2 medium press : Display firmware version <h3>When disconnected</h3>
</li>
</ol>
<ol type="1">
<li>Button 1 short press: On/Off advertising</li>
<li>Button 1 medium press: Cycle through the connection index</li>
<li>Button 1 long press: Clear all bonding info</li>
<li>Button 1 extra long press: Add RPAO characteristic to GAP service &ndash; needed only when DM Privacy enabled</li>
<li>Button 2 medium press : Display firmware version</li>
<li>Button 2 extra long press: Enable device privacy &ndash; start generating local RPAs every 15 minutes </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Feb 19 2024 15:40:04 for Cordio by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
